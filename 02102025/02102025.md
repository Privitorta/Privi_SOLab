# SO(LAB) 2 Ottobre 2025

## SYSCALL scheme
**EAX**: si carica il numero identificativo di funzione per la quale richiediamo l'esecuzione da parte del S.O.
negli altri registri (EBX, ECX, EDX) passiamo eventuali altri argomenti
es. se richiedo una interruzione quando `EAX=1` eseguirà `sys_exit`
es. se richiedo una interruzione quando `EAX=4` eseguirà `sys_write`

`startqemu.sh`
```
user
live
```

### SHELL usage utilities
per più istruzioni di fila semicolon (;) o doppio AND (&&)

## ASM handling
```bash
nasm -f elf nomefile.asm 
ld nomefile.o -o nomefile
./nomefile
wget http://homes.di.unimi.it/re/SYSOPLAB_24_25/asm_examples.tar
tar -xvf asm_examples.tar
cd asm_examples
ls -lah
```

## VIM Usage

`:i` per scrivere nel file in vim

`:q!` per uscire senza salvare (avendo fatto modifiche)

`:wq` per uscire salvando

`:se nu` vedi numeri righe dopo aver aperto il file asm con vim. per toglierli `:se nonu`
in modalità commento invisibile, "num riga + G" salta alla riga scelta
esc + 3 + YY + P (dove voglio incollare) incolla le righe scelte

## E1
```bash
cd E1 ; ls -lah 
cd .. ; vim /E1
vim helloworld.asm
:se nu
:q
nasm -f elf helloworld.asm # compila file asm
```
ora abbiamo il file object (helloworld.o)
```bash
ld helloworld.o -o helloworld
./helloworld
```
output giusto ma dà segfault

## E2
```bash
cd ../E2 ; ls -lah ; vim helloworld.asm
:se nu
nasm -f elf helloworld.asm ; ld helloworld.o -o helloworld ; ./helloworld
```
output giusto, non ha più segfault (fixato exit nell'asm)

## E3
per scrivere nel file in vim: `i`

per uscire senza salvare: `q!`

per uscire salvando: `wq`
```bash
cd ../E3 ; ls -lah
vim helloworld-len.asm
nasm -f elf helloworld-len.asm ; ld helloworld-len.o -o helloworld-len ; ./helloworld-len
```

## E7
```bash
nasm -f elf -gstabs syscallext.asm
ld -I /lib/ld-linux.so.2 -lc -e main -o syscallext syscallext.o
ls -lah
gdb syscallext
(gdb) b main # setta breakpoint a indirizzo di memoria
# uguale a (gdb) break main
(gdb) run
(gdb) x/10i main
(gdb) disas printf
```

